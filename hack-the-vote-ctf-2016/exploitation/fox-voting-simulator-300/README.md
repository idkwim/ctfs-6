# [Hack The Vote CTF 2016](https://pwn.voting): [FOX Voting Simulator 300](https://pwn.voting/challenges#FOX Voting Simulator)

**Category:** Exploitation
**Points:** 300
**Solves:** 26
**Description:**

> In primaries, it is important to get the most attention. With 12 candidates all sharing the stage, it can be hard to pull in voters. Luckily Mr Trump doesn't have much problem with that, but we have a strategy to secure the vote for good. We have found voters respond very well to name recognition, and which ever candidate is polling the highest. We see a snowball effect if we can tip a few online polls his way, then it will be easier for him to take the real ones, and then eventually the nomination.
>
> We were able to dump some of the source code from FOX's new online poll service. We couldn't get everything, but I'm sure that is no problem for you.
> [foxSim](https://s3.amazonaws.com/hackthevote/foxSim.7d62303c1c88beb1c9b59e49422d4eadce93e3daa42b7c6fb50248103ae69a2f.zip)
>
> nc fox.pwn.republican 9000
> 
> author's irc nick: itszn

## writeup

The downloadable challenge zip (hosted also
[here](./foxSim.7d62303c1c88beb1c9b59e49422d4eadce93e3daa42b7c6fb50248103ae69a2f.zip))
contains the C source of the FOX Voting Simulator service
listening at fox.pwn.republican:9000. However, observing the source it can be
found that a small part of it is missing: [`NWO_memberVote`](./foxSim/foxSim.c#L61) function (probably) defined in the missing [`nwo.h`](./foxSim/foxSim.c#L6) header.

### the program flow

Describing the service broadly:

1. it asks for your name (voter),
2. then asks for who you want to vote for (candidate),
3. and asks for the number of votes to give for the candidate.

This is a repeating procedure in an infinite loop called
[`voteLoop`](./foxSim/foxSim.c#L117-L160). The loop starts
after [setting up the candidates](./foxSim/foxSim.c#L164-L167),
and exits only if some exceptions happen.

The data for people (voters and candidates) are stored in
two kinds of structures:
[`Candidate`](./foxSim/fox.h#L4-L12) and
[`Person`](./foxSim/fox.h#L14-L19).

Note, that candidates set up during init are stored as `Candidate`,
you (the voters) are created as `Person`
by calling `createPerson` (./foxSim/foxSim.c#L99-L107)
([if not exists(!)](./foxSim/foxSim.c#L135-L142)),
but both of them are stored in the same
`hashMap`(./foxSim/foxSim.c#L31) hashed array using the
function [`hash`](./foxSim/foxSim.c#L11-L24).
